<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Smart Health Monitor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-image: url("/public/img/background.jpg");
      background-size: cover;
      background-position: center;
      height: 100vh;
      display: flex;
      align-items: center;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 40px;
    }

    .container {
      margin-top: 60px;
      width: 95%;
      max-width: 1200px;
      background: linear-gradient(to bottom right, #ffffffcc, #f0f8ffcc);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(5p);
    }

    h2 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 40px;
      background: linear-gradient(90deg, #ffd700, #ff6347);
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    form {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px 40px;
    }

    label {
      font-weight: bold;
      margin-bottom: 6px;
      display: block;
      color: #333;
    }

    input,
    select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px;
    }

    .buttons {
      grid-column: span 3;
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .buttons button {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      transition: 0.3s ease;
    }

    .predict {
      background: linear-gradient(to right, #6a11cb, #2575fc);
      color: white;
    }

    .predict:hover {
      background: linear-gradient(to right, #2575fc, #6a11cb);
    }

    .download {
      background: crimson;
      color: white;
    }

    .download:hover {
      background: darkred;
    }

    #result {
      grid-column: span 3;
      background: #f5f5f5;
      margin-top: 30px;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    }

    @media screen and (max-width: 1024px) {
      form {
        grid-template-columns: repeat(2, 1fr);
      }

      .buttons,
      #result {
        grid-column: span 2;
      }
    }

    @media screen and (max-width: 600px) {
      form {
        grid-template-columns: 1fr;
      }

      .buttons,
      #result {
        grid-column: span 1;
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>

<body>

  <div class="container">
    <h2>Smart Health Monitoring System for Kids using Machine Learning</h2>
    <form id="healthForm">
      <div>
        <label>Child's Name:</label>
        <input type="text" name="Name" required />
      </div>

      <div>
        <label>Age:</label>
        <input type="number" name="Age" min="1" required />
      </div>

      <div>
        <label>Gender:</label>
        <select name="Gender">
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
        </select>
      </div>
      <div>
        <label>Body Temperature (¬∞F):</label>
        <input type="number" step="0.1" name="BodyTemp" required />
      </div>

      <div>
        <label>Heart Rate (bpm):</label>
        <input type="number" name="HeartRate" required />
      </div>

      <div>
        <label>SpO‚ÇÇ (%):</label>
        <input type="number" step="0.1" name="SpO2" required />
      </div>

      <div>
        <label>Activity Level:</label>
        <select name="ActivityLevel">
          <option>Low</option>
          <option>Normal</option>
          <option>High</option>
        </select>
      </div>

      <div>
        <label>Sleep Hours:</label>
        <input type="number" step="0.1" name="SleepHours" required />
      </div>

      <div>
        <label>Mood:</label>
        <select name="Mood">
          <option>Happy</option>
          <option>Neutral</option>
          <option>Sad</option>
        </select>
      </div>

      <div>
        <label>Concentration Issues:</label>
        <select name="Concentration">
          <option>Yes</option>
          <option>No</option>
        </select>
      </div>

      <div>
        <label>Social Interaction:</label>
        <select name="SocialInteraction">
          <option>Active</option>
          <option>Shy</option>
          <option>Avoidant</option>
        </select>
      </div>

      <div>
        <label>Meals Skipped (per day):</label>
        <input type="number" name="MealsSkipped" min="0" />
      </div>

      <div>
        <label>Water Intake (glasses):</label>
        <input type="number" name="WaterIntake" min="0" />
      </div>

      <div>
        <label>Appetite:</label>
        <select name="Appetite">
          <option>Good</option>
          <option>Normal</option>
          <option>Poor</option>
        </select>
      </div>

      <div>
        <label>Snacking:</label>
        <select name="Snacking">
          <option>Frequent</option>
          <option>Occasional</option>
          <option>Rare</option>
        </select>
      </div>

      <div>
        <label>Night Awakenings (times):</label>
        <input type="number" name="NightAwakenings" min="0" />
      </div>

      <div>
        <label>Trouble Falling Asleep:</label>
        <select name="TroubleSleep">
          <option>Yes</option>
          <option>No</option>
        </select>
      </div>

      <div>
        <label>Hand Hygiene:</label>
        <select name="HandHygiene">
          <option>Regular</option>
          <option>Sometimes</option>
          <option>Rarely</option>
        </select>
      </div>

      <div>
        <label>Mask Use:</label>
        <select name="MaskUse">
          <option>Always</option>
          <option>Sometimes</option>
          <option>Never</option>
        </select>
      </div>

      <div>
        <label>Outdoor Play (hours/day):</label>
        <input type="number" step="0.1" name="OutdoorPlay" min="0" />
      </div>

      <div>
        <label>Screen Time (hours/day):</label>
        <input type="number" step="0.1" name="ScreenTime" min="0" />
      </div>

      <div>
        <label>Fatigue After Play:</label>
        <select name="Fatigue">
          <option>Yes</option>
          <option>No</option>
        </select>
      </div>

      <div class="buttons">
        <button type="submit" class="predict">Predict Health</button>
        <button type="button" class="download">Download</button>
      </div>

      <div id="result"></div>
    </form>
  </div>

  <script>
    const form = document.getElementById("healthForm");
    const resultDiv = document.getElementById("result");
    let latestResult = null;
    let latestInput = null;

    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      latestInput = { ...data };

      const response = await fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const result = await response.json();
      latestResult = result;

      if (result.error) {
        resultDiv.innerText = "Error: " + result.error;
      } else {
        resultDiv.innerHTML = `
        ‚úÖ Fever: ${result.Fever}<br>
        üíß Dehydration: ${result.Dehydration}<br>
        üòü Stress: ${result.Stress}<br>
        ü§ß Flu: ${result.Flu}<br>
        ‚ù§Ô∏è Overall Health: <strong>${result.OverallHealth}</strong>
      `;
      }
    });

    document.querySelector(".download").addEventListener("click", () => {
      if (!latestResult || !latestInput) {
        alert("Please submit the form first to get predictions.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(18);
      doc.text("Smart Health Monitoring Report", 14, 20);

      const inputTable = Object.entries(latestInput).map(([key, val]) => [key, val]);
      const resultTable = Object.entries(latestResult).filter(([k]) => k !== "Recommendations").map(([k, v]) => [k, v]);

      doc.autoTable({
        startY: 30,
        head: [["Input Field", "Value"]],
        body: inputTable,
      });

      doc.autoTable({
        startY: doc.lastAutoTable.finalY + 10,
        head: [["Prediction", "Result"]],
        body: resultTable,
      });

      // Add Recommendations if available
      if (latestResult.Recommendations) {
        const rec = latestResult.Recommendations;
        const recRows = [];

        Object.entries(rec).forEach(([k, v]) => {
          if (typeof v === "object") {
            recRows.push([k, ""]);
            Object.entries(v).forEach(([subKey, val]) => {
              const content = Array.isArray(val) ? val.join(", ") : val;
              recRows.push([`   ${subKey}`, content]);
            });
          } else {
            recRows.push([k, v]);
          }
        });

        doc.autoTable({
          startY: doc.lastAutoTable.finalY + 10,
          head: [["Recommendation Type", "Details"]],
          body: recRows,
        });
      }

      doc.save("Health_Report.pdf");
    });
  </script>

</body>

</html>