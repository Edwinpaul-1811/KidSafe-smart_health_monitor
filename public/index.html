<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smart Health Monitor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 40px;
      background: linear-gradient(to right, #c2e9fb, #a1c4fd);
      color: #333;
    }

    .logout {
      text-align: right;
      margin-bottom: 20px;
    }

    .logout button {
      padding: 8px 16px;
      background: crimson;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .logout button:hover {
      background: darkred;
    }

    h2 {
      text-align: center;
      font-size: 28px;
      color: #2e3c63;
      margin-bottom: 30px;
      background: linear-gradient(90deg, #ffd700, #ff6347);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    form {
      background: white;
      max-width: 700px;
      margin: auto;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button[type="submit"], #downloadBtn {
      width: 100%;
      padding: 12px;
      margin-top: 25px;
      background: linear-gradient(to right, #6a11cb, #2575fc);
      color: white;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    button[type="submit"]:hover, #downloadBtn:hover {
      background: linear-gradient(to right, #2575fc, #6a11cb);
    }

    #result {
      margin-top: 30px;
      background: #ffffffcc;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      font-size: 17px;
      line-height: 1.6;
    }

    .section {
      margin-top: 20px;
    }

    .section-title {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="logout">
    <button onclick="window.location.href='/logout'">Logout</button>
  </div>

  <h2>Smart Health Monitoring System for Kids</h2>

  <form id="healthForm">
    <!-- Input fields (same as before) -->
    <!-- For brevity, keep your full input fields here as is -->
    <!-- You can paste them back from previous version -->
  </form>

  <div id="result"></div>
  <button id="downloadBtn" style="display:none;">Download Result as PDF</button>

  <script>
    const form = document.getElementById("healthForm");
    const resultDiv = document.getElementById("result");
    const downloadBtn = document.getElementById("downloadBtn");

    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      const response = await fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (result.error) {
        resultDiv.innerText = "Error: " + result.error;
        downloadBtn.style.display = "none";
        return;
      }

      // Health summary
      let html = `
        ‚úÖ <strong>Fever:</strong> ${result.Fever}<br>
        üíß <strong>Dehydration:</strong> ${result.Dehydration}<br>
        üòü <strong>Stress:</strong> ${result.Stress}<br>
        ü§ß <strong>Flu:</strong> ${result.Flu}<br>
        ‚ù§Ô∏è <strong>Overall Health:</strong> ${result.OverallHealth}<br>
      `;

      // Recommendations
      let foods = [];
      let cause = [];
      let recovery = [];

      if (result.Fever === "Yes") {
        foods.push("Cool fluids, light soups, fruits like watermelon");
        cause.push("Possible infection or heat");
        recovery.push("2‚Äì4 days with rest and hydration");
      }

      if (result.Dehydration === "Yes") {
        foods.push("Oral rehydration solutions, coconut water, juicy fruits");
        cause.push("Insufficient water intake, excessive sweating");
        recovery.push("1‚Äì2 days with good hydration");
      }

      if (result.Stress === "Yes") {
        foods.push("Bananas, oats, dairy, dark chocolate");
        cause.push("Lack of sleep, academic pressure, screen time");
        recovery.push("3‚Äì7 days with relaxation & routine");
      }

      if (result.Flu === "Yes") {
        foods.push("Warm fluids, honey-lemon water, vitamin C rich foods");
        cause.push("Viral infection");
        recovery.push("5‚Äì7 days with medicine & rest");
      }

      if (foods.length > 0) {
        html += `
          <div class="section">
            <div class="section-title">ü•ó Recommended Foods:</div>
            <div>${foods.join("; ")}</div>
          </div>
          <div class="section">
            <div class="section-title">üîç Possible Causes:</div>
            <div>${cause.join("; ")}</div>
          </div>
          <div class="section">
            <div class="section-title">üïí Recovery Estimate:</div>
            <div>${recovery.join("; ")}</div>
          </div>
        `;
      }

      resultDiv.innerHTML = html;
      downloadBtn.style.display = "block";
    });

    downloadBtn.addEventListener("click", async () => {
      const resultElement = document.getElementById("result");
      const canvas = await html2canvas(resultElement, { scale: 2 });
      const imgData = canvas.toDataURL("image/png");

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      const imgProps = pdf.getImageProperties(imgData);
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

      pdf.addImage(imgData, "PNG", 10, 10, pdfWidth - 20, pdfHeight);
      pdf.save("Health_Prediction_Report.pdf");
    });
  </script>
</body>
</html>
